name: Run Script

on:
  schedule:
    # Multiple random-looking times throughout the day (UTC)
    - cron: '23 3 * * *'   # ~3:23 AM UTC
    - cron: '47 7 * * *'   # ~7:47 AM UTC
    - cron: '12 11 * * *'  # ~11:12 AM UTC
    - cron: '38 15 * * *'  # ~3:38 PM UTC
    - cron: '5 19 * * *'   # ~7:05 PM UTC
    - cron: '51 22 * * *'  # ~10:51 PM UTC
  workflow_dispatch:          # Manual trigger

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4

      - name: Random short delay (1-20 min)
        if: github.event_name == 'schedule'
        run: |
          DELAY=$((RANDOM % 1200 + 60))
          MINS=$((DELAY / 60))
          echo "Sleeping for $MINS minutes ($DELAY seconds)..."
          sleep $DELAY

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Run script
        run: python leetcode_submit.py
        env:
          LEETCODE_CSRF: ${{ secrets.LEETCODE_CSRF }}
          LEETCODE_SESSION: ${{ secrets.LEETCODE_SESSION }}
